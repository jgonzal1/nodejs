<head>
</head>
<body>
  <!--<img id="def" src="./default.png">style="display:none;"-->
  <canvas id="dashCanvas" width="192" height="192" style="border:1px solid #d3d3d3;"></canvas>
  <button id="makeDash" onclick="makeDash()">makeDash</button>
  <script>
    /**
     * @param {string} canvasHtmlId
     * @param {string} imageSpritePath
     * @param {number} height must be the same of the  width of each the sprite
     * @param {number} numberOfFrames
     */ 
    function dash(canvasHtmlId, imageSpritePath, height, numberOfFrames) {
      var canvas = document.getElementById(canvasHtmlId);
      var imageSprite,
        imageSpriteImage;
      function gameLoop () {
        window.requestAnimationFrame(gameLoop);
        imageSprite.update();
        imageSprite.render();
      }
      function sprite (options) {
        var that = {},
            frameIndex = 0,
            tickCount = 0,
            ticksPerFrame = options.ticksPerFrame || 0,
            numberOfFrames = options.numberOfFrames || 1;
        that.context = options.context;
        that.width = options.width;
        that.height = options.height;
        that.image = options.image;
        that.update = function () {
          tickCount += 1;
          if (tickCount > ticksPerFrame) {
            tickCount = 0;
            if (frameIndex < numberOfFrames - 1) { // The current frame index is in range
              frameIndex += 1; // Go to the next frame
            } else {
              // frameIndex = 0;
              that.context = null;
              that.image = null;
            }
          }
        };
        that.render = function () {
          that.context.clearRect(0, 0, that.width, that.height);
          // that.context.fillStyle = "#444444";
          var xDash, yDash, backwardFrameIndex;
          var backwardFrameInit = 2*numberOfFrames/3;
          if (frameIndex <= backwardFrameInit) {
            xDash = frameIndex
            yDash = (frameIndex-20)*frameIndex/10;
          } else {
            backwardFrameIndex = frameIndex - backwardFrameInit;
            xDash = numberOfFrames - frameIndex
            yDash = (backwardFrameIndex-10)*backwardFrameIndex/5;
          }
          that.context.drawImage(
            that.image,                    // image, canvas, or video element to use	
            0,                             // image x coordinate where to start clipping
            0,                             // that.height-canvas.height image y coordinate where to start clipping
            that.width,                    // width of the clipped image on the canvas
            that.height,                   // height of the clipped image on the canvas
            xDash,                         // x coordinate where to place the clipped image on the canvas
            yDash,                         // y coordinate where to place the clipped image on the canvas
            that.width,                    // image to use width (to stretch or reduce it)
            that.height                    // image to use height (to stretch or reduce it)
          );
        };
        return that;
      }
      imageSpriteImage = new Image(); // Create sprite sheet
      imageSprite = sprite({ // Create sprite
        context: canvas.getContext("2d"),
        height: height,
        image: imageSpriteImage,
        numberOfFrames: numberOfFrames,
        width: height*numberOfFrames,
        ticksPerFrame: Math.round(10/numberOfFrames)
      });
      imageSpriteImage.addEventListener("load", gameLoop); // Load sprite sheet
      imageSpriteImage.src = imageSpritePath;
    }

    function makeDash() {
      dash("dashCanvas","default.png", 128, 30);
    }
  </script>
</body>